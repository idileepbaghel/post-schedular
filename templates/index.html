{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">

<div class="container-fluid d-flex flex-column align-items-center">
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 11;">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

  <h1 class="fw-bold text-white">ğŸ¤– AI Content & Image Generator</h1>

  <div class="content-wrapper">

    <!-- ===== TEXT GENERATION FORM ===== -->
    <div class="form-container mb-5">
      <h4 class="fw-bold text-dark mb-3">ğŸ“ Generate AI Content</h4>
      <form method="POST" action="{{ url_for('home') }}" id="textForm">
        <div class="row">
          <div class="mb-3 col-md-6">
            <label class="fw-semibold">Content Length<span class="text-danger">*</span></label>
            <select class="form-select border-2" name="content_length" required>
              <option value="" disabled selected>Choose length...</option>
              <option>Short</option>
              <option>Medium</option>
              <option>Lengthy</option>
            </select>
          </div>

          <div class="mb-3 col-md-6">
            <label class="fw-semibold">Content Schedule<span class="text-danger">*</span></label>
            <select class="form-select border-2" name="content_schedule" required>
              <option value="" disabled selected>Choose schedule...</option>
              <option>2 Days</option>
              <option>5 Days</option>
              <option>10 Days</option>
              <option>1 Week</option>
              <option>2 Weeks</option>
            </select>
          </div>
        </div>

        <div class="mb-3">
          <label class="fw-semibold">Enter Prompt<span class="text-danger">*</span></label>
          <textarea class="form-control border-2" name="prompt" rows="5"
            placeholder="Example: Write a blog post about AI in education..." required></textarea>
        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-primary">âœ¨ Generate Content</button>
        </div>

        <div class="loading" id="textLoading" style="display:none;">
          <div class="loader"></div>
          <p class="mt-3" style="color: #125578; font-weight: 600;">Generating content, please wait...</p>
        </div>
      </form>

      <!-- TEXT OUTPUT -->
      <div class="output-container mt-4">
        <h5 class="fw-bold text-dark">Generated Content</h5>
        <div class="output-content" id="textOutput">
          {% if generated_text %}
            {{ generated_text | safe }}
          {% else %}
            <p class="text-muted">Your generated content will appear here...</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- ===== IMAGE GENERATION FORM ===== -->
    <div class="form-container">
      <h4 class="fw-bold text-dark mb-3">ğŸ–¼ï¸ Generate AI Image</h4>
      <form method="POST" action="{{ url_for('home') }}" id="imageForm">
        <div class="mb-3">
          <label class="fw-semibold">Enter Prompt for Image<span class="text-danger">*</span></label>
          <textarea class="form-control border-2" name="prompt" rows="4"
            placeholder="Example: A futuristic AI classroom with students and robots..." required></textarea>
        </div>

        <div class="text-center">
          <button type="submit" class="btn btn-success">ğŸ¨ Generate Image</button>
        </div>

        <div class="loading" id="imageLoading" style="display:none;">
          <div class="loader"></div>
          <p class="mt-3" style="color: #125578; font-weight: 600;">Generating image, please wait...</p>
        </div>
      </form>

      <!-- IMAGE OUTPUT -->
      <div class="output-container mt-4">
        {% if generated_image %}
        <h5 class="fw-bold text-dark">Generated Image</h5>
        <div class="image-result text-center mt-2">
          <img src="data:image/png;base64,{{ generated_image }}" alt="Generated Image"
            class="img-fluid rounded shadow" style="max-width: 600px;">
        </div>
        {% else %}
          <p class="text-muted">Your generated image will appear here...</p>
        {% endif %}
      </div>
    </div>

  </div>
</div>

<script>
  // Show loading indicator for text
  document.getElementById('textForm').addEventListener('submit', function () {
    document.getElementById('textLoading').style.display = 'block';
  });

  // Show loading indicator for image
  document.getElementById('imageForm').addEventListener('submit', function () {
    document.getElementById('imageLoading').style.display = 'block';
  });
</script>
{% endblock %}
