{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">

<div class="container-fluid d-flex flex-column align-items-center">

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="position-fixed top-0 end-0 p-3" style="z-index: 11;">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <h1 class="fw-bold text-white">ðŸ¤– AI LinkedIn Content Generator</h1>

  <!-- LinkedIn Status -->
  <div class="mb-3">
    {% if session.get('linkedin_token') %}
      <span class="badge bg-success fs-6 px-3 py-2">
        <i class="bi bi-check-circle"></i> Connected as {{ session.get('linkedin_user', 'User') }}
      </span>
    {% else %}
      <a href="{{ url_for('linkedin_login') }}" class="btn btn-outline-dark">
        <i class="bi bi-linkedin"></i> Connect to LinkedIn
      </a>
    {% endif %}
  </div>

  <div class="content-wrapper">
    <div class="form-container">
      <form method="POST" action="{{ url_for('generate_text') }}" id="textForm">
        
        <!-- Content Controls -->
        <div class="row">
          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Content Length<span class="text-danger">*</span></label>
            <select name="content_length" class="form-select border-2" required>
              <option value="" disabled selected>Choose length...</option>
              <option>Short</option>
              <option>Medium</option>
              <option>Lengthy</option>
            </select>
          </div>

          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Content Schedule<span class="text-danger">*</span></label>
            <select name="content_schedule" class="form-select border-2" required>
              <option value="" disabled selected>Choose schedule...</option>
              <option>2 Days</option>
              <option>5 Days</option>
              <option>10 Days</option>
              <option>1 Week</option>
              <option>2 Weeks</option>
            </select>
          </div>
        </div>

        <!-- Dates -->
        <div class="row mt-2">
          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Start Date<span class="text-danger">*</span></label>
            <input type="date" name="start_date" class="form-control" required>
          </div>

          <div class="col-md-6 mb-3">
            <label class="fw-semibold">Number of Days<span class="text-danger">*</span></label>
            <input type="number" name="num_days" min="1" max="30" class="form-control" value="1" required>
          </div>
        </div>

        <!-- Core Inputs with Dropdowns -->
       <div class="row mt-3">
          <div class="mb-3 col-md-6">
            <label class="fw-semibold">Topic / Context<span class="text-danger">*</span></label>
            <select class="form-select border-2" name="topic_context" required>
              <option value="" disabled {% if not topic_context %}selected{% endif %}>Choose topic...</option>
              <option {% if topic_context == 'AI training program for students and teachers' %}selected{% endif %}>AI training program for students and teachers</option>
              <option {% if topic_context == 'My career milestone' %}selected{% endif %}>My career milestone</option>
              <option {% if topic_context == 'A lesson I learned as a leader' %}selected{% endif %}>A lesson I learned as a leader</option>
              <option {% if topic_context == 'Product announcement' %}selected{% endif %}>Product announcement</option>
              <option {% if topic_context == 'Event recap' %}selected{% endif %}>Event recap</option>
              <option {% if topic_context == 'Thought leadership' %}selected{% endif %}>Thought leadership</option>
            </select>
          </div>

          <div class="mb-3 col-md-6">
            <label class="fw-semibold">Purpose / Goal<span class="text-danger">*</span></label>
            <select class="form-select border-2" name="purpose_goal" required>
              <option value="" disabled {% if not purpose_goal %}selected{% endif %}>Choose purpose...</option>
              <option {% if purpose_goal == 'Awareness' %}selected{% endif %}>Awareness</option>
              <option {% if purpose_goal == 'Engagement' %}selected{% endif %}>Engagement</option>
              <option {% if purpose_goal == 'Leads' %}selected{% endif %}>Leads</option>
              <option {% if purpose_goal == 'Inspiration' %}selected{% endif %}>Inspiration</option>
              <option {% if purpose_goal == 'Recruitment' %}selected{% endif %}>Recruitment</option>
              <option {% if purpose_goal == 'Announcement' %}selected{% endif %}>Announcement</option>
              <option {% if purpose_goal == 'Thought leadership' %}selected{% endif %}>Thought leadership</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="row">
          <div class="mb-3 col-md-6">
            <label class="fw-semibold">Target Audience<span class="text-danger">*</span></label>
            <select class="form-select border-2" name="target_audience" required>
              <option value="" disabled {% if not target_audience %}selected{% endif %}>Choose audience...</option>
              <option {% if target_audience == 'Students' %}selected{% endif %}>Students</option>
              <option {% if target_audience == 'Educators' %}selected{% endif %}>Educators</option>
              <option {% if target_audience == 'Professionals' %}selected{% endif %}>Professionals</option>
              <option {% if target_audience == 'Recruiters' %}selected{% endif %}>Recruiters</option>
              <option {% if target_audience == 'Corporate leaders' %}selected{% endif %}>Corporate leaders</option>
            </select>
          </div>

          <div class="mb-3 col-md-6">
            <label class="fw-semibold">Tone of Voice<span class="text-danger">*</span></label>
            <select class="form-select border-2" name="tone_of_voice" required>
              <option value="" disabled {% if not tone_of_voice %}selected{% endif %}>Choose tone...</option>
              <option {% if tone_of_voice == 'Professional' %}selected{% endif %}>Professional</option>
              <option {% if tone_of_voice == 'Inspiring' %}selected{% endif %}>Inspiring</option>
              <option {% if tone_of_voice == 'Humble' %}selected{% endif %}>Humble</option>
              <option {% if tone_of_voice == 'Conversational' %}selected{% endif %}>Conversational</option>
              <option {% if tone_of_voice == 'Storytelling' %}selected{% endif %}>Storytelling</option>
              <option {% if tone_of_voice == 'Promotional' %}selected{% endif %}>Promotional</option>
              <option {% if tone_of_voice == 'Thought-provoking' %}selected{% endif %}>Thought-provoking</option>
            </select>
          </div>
        </div>

        <!-- Optional Inputs -->
        <div class="mb-3">
          <label class="fw-semibold">Keywords (help guide post creation)</label>
          <textarea name="keywords" class="form-control border-2" rows="2" placeholder="e.g., innovation, leadership, learning, teamwork"></textarea>
        </div>

        <div class="mb-3">
          <label class="fw-semibold">Optional Call-to-Action (CTA)</label>
          <input type="text" name="cta" class="form-control border-2" placeholder="e.g., Letâ€™s connect! | Comment your thoughts!">
        </div>

        <div class="mb-3">
          <label class="fw-semibold">Additional Notes</label>
          <textarea name="prompt" class="form-control border-2" rows="3" placeholder="Add extra context or tone guidance..."></textarea>
        </div>

        <div class="mb-3">
          <label class="fw-semibold">Hashtags</label>
          <input type="text" name="hashtags" class="form-control border-2" placeholder="Leave blank to auto-generate hashtags">
        </div>

        <div class="mb-3">
          <label class="fw-semibold">Formatting Preference</label>
          <select name="formatting" class="form-select border-2">
            <option value="" disabled selected>Select format</option>
            <option>Short & Punchy</option>
            <option>Story Format</option>
            <option>Professional Announcement</option>
            <option>Carousel-Friendly</option>
            <option>Listicle</option>
          </select>
        </div>

        <div class="text-center">
          {% if not session.get('linkedin_token') %}
            <button type="button" class="btn btn-primary btn-lg" disabled>ðŸ”’ Connect to LinkedIn first</button>
          {% else %}
            <button type="submit" class="btn btn-primary btn-lg">âœ¨ Generate Content</button>
          {% endif %}
        </div>

        <div class="loading" id="textLoading" style="display:none;">
          <div class="loader"></div>
          <p class="mt-3 text-primary fw-semibold">Generating your posts, please wait...</p>
        </div>

      </form>
    </div>
  </div>
</div>

<script>
  document.getElementById('textForm').addEventListener('submit', () => {
    document.getElementById('textLoading').style.display = 'block';
  });
</script>
{% endblock %}
